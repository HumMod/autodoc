<!DOCTYPE html>

<!--
   Created : 2014-11-15
   Revised : 2014-11-15
   Author : Tom Coleman
   Copyright : 2013-2013
   By : Tom Coleman
-->

<html>
<head>
<title> HumMod Developers Log - 2013 </title>
<link rel='stylesheet' type='text/css' href='LogStyle.css'>
</head>

<body>

<span class='pagetitle'> HumMod Developers Log - 2013 </span>

<p>
2013-10-31. Log file was getting too large to be useful. Moved log
content between 2012-01-19 and 2013-05-09 to Log(Archived).html.
This new file resides in the repository but is not visible as Web
content.

<p>
2013-05-09. ScriptedController bumped to v2.0.14.

<p>
Thanks to Drew for this ticket. I wrote 2 scripts that
verify that ScriptedController freezes on dumpsegment
and dumpsolution when the roster is rosterall.

<p>
My bad. ScriptedController was actually running OK
with rosterall. It was just taking an infinite amount
of time. The dumped file is quite large (8000 vars *
20 bytes/value * 10 values/var = 1 - 2 MB). The files
image is constructed internally in a string.

<p>
.Net framework has two ways to represent a string :
as a string object and as a StringBuilder object.
String objects are immutable and must be continually
created and distroyed when building a large string
from small fragments. StringBuilder objects are like
huge arrays where fragments can be dumped in at light
speed. SciptedController can now write a segment or
solution using rosterall at a speed that seems
instantaneous. Check your LOG file.

<p>
Edits are in StorageDumper.CS.

<p>
2013-05-07. Scripter bumped to v2.0.0 in preparation
for a major rewrite. Scripter is the utility that
converts the XML version of a model to its JavaScript
equivalent. 2013-05-08 Revision done but not pushed.

<p>
2013-04-30. HumMod bumped to v2.0.66. Corrected a math
mis-statement that may have caused implicit algebraic
convergence problems under severe conditions.

<p>
XML in LeftHeartPumping-Systole.TMP-Passive and in
RightHeartPumping ... Not visible.

<p>
2013-04-11. ScriptedController overhaul. Version
bumped to 2.0.13. Code in AboutDialogBox.CS.

<p>
NB. Reset is no longer a valid element -- it is no
longer required. All scripts using this element will
fail to parse.

<p>
Changed display in IO_Load_ICs to show that these
values are now current values. These values go across
to the model solver as current values.

<p>
IPC_Out_Sending_ICs keeps its class name, but sends
a sending_current_values message.

<p>
IPC_Out_Reset has been removed.

<p>
S_Reset has been removed and S_Script no longer refers
to this class.

<p>
IPC_In_VarRoster no longer refers to IPC_Out_Reset.

<p>
Script_Reset and Work_Reset classes have been removed.

<p>
2013-04-11. InteractiveController overhaul. Version
bumped to 1.1.15. Code in AboutDialogBox.CS.

<p>
InteractiveController no longer calls for a reset
when loading. Code edited in StartupManager.CS.
Classes ResetManager and IPC_Out_Reset are no longer
needed.

<p>
A tab in the Advanced tabbed dialog implemented a
model reset. Removed.

<p>
Changed the labels in the File menu to Save Current
Values and Load Current Values to more accurately
reflect what is really going on.

<p>
When current values are loaded from a file (IO_Load_ICs.CS,
class name has not been changed) the values are sent
to the model solver as current values and the model
solver is not restarted. Classes Sending_ICs_Manager
and IPC_Out_Sending_ICs have been removed.

<p>
2013-04-11. ModelSolver overhaul. Version bumped to
1.0.16.

<p>
In Var_Base.CS, the DefaultIC property of the Var_Base
object has been removed. AddVal now adds a value to the
IC property.

<p>
In Var_Base_Messages.CS, the method ResetModel has been
removed. The concept of reset is no longer supported.
The parser loads IC values and these values are preserved.
The RequestData() method no longer returns a DefaultIC
image.

<p>
In SolutionManager.CS, the method Reset() has been
removed.

<p>
The class IPC_In_Reset has been removed. This is the class
that processed the reset message. The class S_Reset has
been removed. This class defined the reset message schema.
The S_SolverIn class no longer tries to build the reset
schema into the overall messaging schema.

<p>
There were previously two messages that sent across values :
sending_ics and sending_current_values. Sending_ics has
been removed as values now can only come across as current.
S_Sending_ICs.CS and IPC_In_Sending_ICs.CS have been deleted.
The S_SolverIn class no longer looks for the IC's schema.

<p>
2013-04-11. Modeling arterial and venous O2 is difficult
because O2 flows are large and O2 masses are small. This
is stiff. I was using stable delays on both the arterial
and venous sides. But this did not represent mass balance
very well during O2 transients. Now using stable integrals
on the arterial and venous sides. Very stable and mass
balance is represented correctly.

<p>
XML is at Structure\O2\O2Artys and O2Veins. Visible at
Respiration | O2 | Blood Arties and Veins.

<p>
2013-04-10. HumMod bumped to v2.0.65.

<p>
2013-04-10. Still HumMod v2.0.64. Autopsy executes some
code and one of the variables (OsmBody ...) was incorrectly
named. This was visible only when HumMod died. Fixed.

<p>
2013-04-04. Move these repo's to Archives : TheValidator,
TheBatchValidator, validation. Deleted these repo's in
GitHub.

<p>
HumMod bumped to 2.0.64. Doing some minor edits. Added a
clock icon to the chart (visible under Diagnosis | Chart). 

<p>
2013-04-03. Scripter bumped to v1.0.1. Scripter now cancels
automatic parse when launched with the control key pressed.
Removed all items from the File menu except exit. Work flow
is defined in the Options tabbed dialog box.

<p>
2013-03-28. HumMod bumped to v2.0.63. Added content to
Lactate-Transport.REF (in Structure\Lactate) indicating that
lactate movement in and out of organs should be both flow
and diffusion limited. Also backward Euler integration for
organ lactate mass may be a good choice (replacing the
current mess -- as identified by Drew and Victoria).

<p>
All 12 organs get a lactate redo including backward Euler.
Panels are at Organs | OrganName | Lactate. These panels
get 2 new graphs : lactate made and lactate used. The
technical box is gone.

<p>
2013-03-27. Implementing a message pair to request the
roster of parameters from the ModelSolver and to get
a roster message in response.

<p>
Documentation edits at ScriptedController\Docs\Schema\Message\

<ul>
<li> SolverIn\Overview-SolverIn
<li> SolverIn\SolverIn-RequestParmRoster
<li> SolverOut\Overview-SolverOut
<li> SolverOut\SolverOut-ParmRoster
</ul>

<p>
ModelSolver bumped to version 1.0.15. ModelSolver source
code edits.

<ul>
<li> AboutDialogBox.CS
<li> S_SolverIn.CS
<li> S_RequestParmRoster.CS
<li> IPC_In_RequestParmRoster.CS
<li> Var_Base_Messages.CS
<li> IPC_Out_ParmRoster.CS
</ul>

<p>
Documentation edits at ScriptedController\Docs\Schema\Script\

<ul>
<li> Overview-Script
<li> Element-RosterParms
</ul>

<p>
ScriptedController bumped to version 2.0.12. ScriptedController
source code edits.

<ul>
<li> AboutDialogBox.CS
<li> S_Script.CS
<li> S_RosterParms.CS
<li> Script_RosterParms.CS
<li> Work_RosterParms.CS
<li> IPC_Out_RequestParmRoster.CS
<li> S_ParmRoster.CS
<li> IPC_In_ParmRoster.CS
</ul>

<p>
Sample files at ScriptedController\Docs\Scripts\

<ul>
<li> RosterParms.Script
<li> RosterParms.LOG
<li> RosterParms.DUMP
</ul>

<p>
2013-03-25. HumMod held at v2.0.62. Fixed 2 instances in
Display\Right, LeftHeartPumping\Systole\TechnicalActive
where in inc element in a showcurve was empty. Modular
Controller wouldn't parse a space to a number.

<p>
Note to Robert. EXE has a tab in Options called Reset |
Restart. It has two options : 1) reset the model and solver
to their original values and restart the solution and 2)
move current values to initial conditions and restart
solution.

<p>
In ScriptedController's Advanced tabbed dialog, the Reset
panel does 1) above. But 2) above now has its own panel
tabbed New IC's. It appears to work just fine.

<p>
The current version of InteractiveController is 1.1.14 and
it appears to Save and Load initial conditions without
error. What it doesn't appear to do is refresh a panel's
graphs under certain conditions. The work around is to
tab to a different panel and then tab back to force a
refresh.

<p>
2013-03-23. There is a working description (with example)
of ScriptedController's validation elements at
Docs\Schema\Script\Model Validation Notes.DOCX.

<p>
For now, 5 elements have be added (this is a simple
implementation).

<ul>
<li> &lt;stats_log_global/&gt;
<li> &lt;stats_log_local/&gt;
<li> &lt;stats_reset_global/&gt;
<li> &lt;stats_reset_local/&gt;
<li> &lt;stats_test&gt; ... &lt;/stats_test&gt;
</ul>

<p>
The new C# classes are

<ul>
<li> S_Stats_Log_Global.CS
<li> S_Stats_Log_Local.CS
<li> S_Stats_Reset_Global.CS
<li> S_Stats_Reset_Local.CS
<li> S_Stats_Test.CS
<li> Script_Stats_Log_Global.CS
<li> Script_Stats_Log_Local.CS
<li> Script_Stats_Reset_Global.CS
<li> Script_Stats_Reset_Local.CS
<li> Script_Stats_Test.CS
<li> Work_Stats_Log_Global.CS
<li> Work_Stats_Log_Local.CS
<li> Work_Stats_Reset_Global.CS
<li> Work_Stats_Reset_Local.CS
<li> Work_Stats_Test.CS
<li> Stats_Aggregate_Global.CS
<li> Stats_Aggregate_Local.CS
<li> Stats_Test.CS
</ul>

<p>
2013-03-22. ScriptedController bumped to v2.0.11. Will be
adding validation functionality to this module.

<p>
2013-03-22. HumMod bumped to v2.0.62. Added some documentation
in

<ul>
<li> AminoAcid
<li> Nephron\Ketoacids
<li> Posture
</ul>

<p>
2013-03-20. Thanks to John Clemmer for putting together all of
the physiology that connects hemorrhage to gluconeogenesis.
And also digging out a ton of important papers in the biomedical
literature.

<p>
Created (hypothalamic) nuclei to help control the secretion of
ADH and CRF. Outflow from the nuclei are a function of
barorecptor activity, low pressure receptor stimulation and
glucose receptor stimulation. ADH secretion retains its strong
osmotic influence. XML is at Nerves\Nucleus-ADH and Nucleus-CRF.
Visible at Nervous System | Autonomics | CNS.

<p>
Rebuilt CRF. [CRF] in portal blood is a function of NA at its
nucleus, stress and [cortisol] (inhibitory). XML at Structure\
CorticotropinReleasingFactor. Visible at Hormones | Corticotropin
Releasing Factor.

<p>
Rebuilt ACTH to include effect of ADH on ACTH secretion and the
newly revised [CRF]. XML at Structure\ACTH. All new panel at
Hormones | ACTH.

<p>
Removed the structure for pituitary nerve. The concept was not
a good one. ADH secretion now gets its neural input from
Nucleus-ADH.NA.

<p>
Reorganized the ADH | Formation panel's secretion box to better
show causality. Visible at Hormones | ADH | Formation.

<p>
Last log for v2.0.61. It goes 1 week of steady state in 1830
steps.

<p>
2013-03-19. HumMod bumped to v2.0.61. Added nG/dL to aldo
panel along with some additional stuff in the aldo information
box.

<p>
Reorganized the presentation of drugs. Dosing and kinetics for
each drug are now presented together under Interventions.
Kinetics is no longer displayed under Miscellaneous.

<p>
Implemented (hypothalamic) glucose receptors. XML is at
Structure\Nerves\GlucoseReceptors. Visible at Nervous System
| Autonomics | Afferents. No CNS integration yet.

<p>
2013-03-19. Last log for v2.0.60. It goes 1 week of steady
state in 1700 steps.

<p>
2013-03-18. Added panels under Kidney ... Nephrons to provide
the details of the determinants of fractional Na+ reabsorption
and K+ secretion. Panels are visible at

<ul>
<li> Proximal Tubule
<li> Loop Of Henle
<li> Distal Tubule
<li> Collecting Duct
</ul>

<p>
Added a groupbox to show the dynamics of the collecting duct
H2O channels. Visible at Organs | KKidney ... Nephrons |
Collecting Duct | Water.

<p>
Cleaned up the cortisol panel, giving it boxes for secretion
and disposal. And moving mass into the pool box. Visible at
Hormones | Cortisol.

<p>
2013-03-17. Implemented the MineralocorticoidReceptor. XML is at
Structure\MineralocorticoidReceptor. Visible at Organs |
Kidney ... Nephrons | Aldosterone.

<p>
2013-03-16. Installed spironolactone up to receptor dynamics.
XML is at Drugs\Spironolactone\ several structures. Panels are
visible at Interventions | Drugs | Spironolactone and Miscellaneous |
Pharmacokinetics | Spironolactone.

<p>
2013-03-15. HumMod bumped to v2.0.60. Added a calculation to
diet goal to electrically balance the electrolyte intake. XML
in Diet\DietGoalElectrolytes. Visible at Lifestyle | Diet |
Goal. Right now, the added HCO3- and NH4+ don't actually make
it to the gut.

<p>
2013-03-13. HumMod bumped to v2.0.59 after correcting a small
problem with stiffness. V2.0.58 did standing just fine but was
too stiff for long-term simulations. V2.0.59 should do better.

<p>
2013-03-13. Had some data from Musgrove using LBNP and a waist
down plethysmograph that indicated that about 800 mL of blood
move to the lower torso on standing. OK, so this informs HumMod's
sequestered blood. But upon HumMod standing, stroke volume is
basically unchanged while in reality stroke volume falls dramatically.
What was not in HumMod was the fact that upon standing all of the
blood below the heart gets a hydrostatic gradient that impedes
venous return. This is equivalent to a sequestration of 1400 mL
(1200 in veins, 200 in arteries, for now). So 2.0.58 stands rather
nicely. I'll try to make this more anatomically correct later.

<p>
XML at SequesteredBlood\BVSeqVein.

<p>
2013-03-10. Sympathetic integration now has CNS centers (sort of
nuclei) for
 
<ul>
<li> General
<li> Adrenal
<li> Cardiac
<li> Renal
<li> Hepatic
<li> Mesenteric
</ul>

<p>
Just like the ganglia. XML is in Nerves. Visible at Nervous System
| Autonomics | CNS. The renal and mesenteric tracts now produce
a brisk vasoconstriction when the low pressure receptors are
unloaded upon standing. This conforms to supporting human data from
standing and LBNP.

<p>
2013-03-09. Moved coronary sinus, hepatic artery, hepatic vein,
portal vein and venae cava to structure top level. Part of the
motivation for this move is that hepatic artery is about to get
alpha vasoconstrictor function. Moved splanchnic circulation and
venae cava panels from Circulation | Blood Vessels to Circulation. 

<p>
Added alpha receptors to hepatic artery. XML is at Hepatic Artery,
HepaticArtery-Flow and HepaticArtery-AlphaReceptors. Panel at
Circulation | Splanchnic Circulation | Hepatic Artery.

<p>
2013-03-07. Blood sample now refers to OsmBody.CellWall(mOsm/L)
which is the correct reference.

<p>
Connected ganglia to the target organs : cardiac to right and
left heart, hepatic to liver, GI to GI tract, adrenal to adrenal
nerve.

<p>
Expanded the content in the alpha and beta pool panels. Visible
at Nervous System | Catechols.

<p>
2013-03-06. HumMod bumped to v2.0.58. Expanded ANP display from
a single panel to pool and secretion panels. Visible at Hormones
| ANP.

<p>
Putting in the infrastructure for a more detailed sympathetic
nervous system. First in are the sympathetic ganglia.

<ul>
<li> General
<li> Adrenal
<li> Cardiac
<li> Renal
<li> Hepatic
<li> Mesenteric
</ul>

<p>
XML is at Nerves\Ganglia-GangliaName. Visible at Nervous System
| Autonomic Nerves | Efferents.

<p>
2013-03-06. Sized all of the components that are needed to size
osmolality properly. Then sized it. Cell wall osmolality now
starts ~284 with osmoreceptor osmolality at ~ 271. The cell wall
osmolality partitions body H2O into ECFV and ICFV, so its good to
get off to a good start. XML is at Sizing\Sizing-Osmoles. Panel
at Sizing | Osmoles. Sizing components are visible in other sizing
panels.

<p>
Fixed a pitiful error in the way that osmoreceptor osmolality is
caleculated. XML at Osmoles\OsmBody.

<p>
Calibrated the ADH secretion response to osmoreceptor osmolality.

<p>
Calibrated the ANP secretion response to RA-TMP and LA-TMP.

<p>
The goal here is to have a model that can solve for 1 week in 2000
steps or less. 2.0.57 goes 1 week in 1600 steps, so good.

<p>
2013-03-02. HumMod bumped to v2.0.57. Added a Pressures structure
that is initialized by Sizing-Pressures. It will be used later in
controlling ANP secretion and maybe some other stuff.

<p>
Cleaned up HumMod's root by removing stuff (Stochastic and Scholar)
that is not going anywhere.

<p>
Continued to revise and improve HumMod's sizing. XML is at
<ul>
<li> Sizing-TissueH2O.DES
<li> Sizing-ExternalH2O.DES
<li> Sizing-BodyH2O.DES
<li> Sizing-ECFV.DES
<li> Sizing-ICFV.DES
<li> Sizing-InterstitialWater.DES
<li> Sizing-CellH2O.DES
</ul>

<p>
Panels are at Sizing | H2O.

<p>
2013-03-01. Bumped HumMod to v2.0.56. Added a structure named
Density to host the various densities that HumMod uses. These
values will be used both in sizing and solving. 

<p>
2013-02-28. I didn't appreciate the importance of the lymphatic
system concentrating protein at the lymph nodes. The result was
a slow redistribution of circulatory protein the pulled plasma
volume, cardiac output and arterial pressure down. Won't go into
the physiology here. But, added some additional panels (supplementing
Miscellaneous | Torso) at Circulation | Interstitium.

<p>
Added lymph protein concentrating. Added a new parameter set for
capillary water permeability and capillary protein diffusing
coefficient.

<p>
2013-02-27. HumMod bumped to v2.0.55. Moved some notes into
Structure\TissueH2O related to lymph flow.

<p>
2013-02-26.Added sizing to heart pumping. This sizes the
diastolic and systolic pressure-volume curves. The XML is at

<ul>
<li> Sizing-HeartPumping-Right-Diastole
<li> Sizing-HeartPumping-Right-Systole
<li> Sizing-HeartPumping-Right-ContractileProtein
<li> Sizing-HeartPumping-Left-Diastole
<li> Sizing-HeartPumping-Left-Systole
<li> Sizing-HeartPumping-Left-ContractileProtein
</ul> 

<p>
Added sizing for the low-pressures receptors. The adapted
pressure needs an accurate start.

<p>
Tweaked blood volume sequestered in veins to get an initial
volume of 150 mL at a lower torso venous pressure of 14 mmHg.

<p>
Systemic veins outflow was not including coronary sinus
blood flow. Fixed. My bad.

<p>
2013-02-25. Bump HumMod to v2.0.54. Added some pressures to
Sizing-Pressures. Visible at Sizing | Pressures.

<p>
2013-02-25. Installed basic cardiac hypertrophy physiology.
Heart contractile protein mass is a function of end-systolic
ventricular wall stress with a delay in between. XML is at

<ul>
<li> RightHeartWallStress-Systole
<li> RightHeartPumping-ContractileProtein
<li> LeftHeartWallStress-Systole
<li> LeftHeartPumping-ContractileProtein
</ul>

<p>
Panels at

<ul>
<li> Circulation | Right Heart Wall Stress | Systole
<li> Circulation | Right Heart Pumping | Contractile Protein
<li> Circulation | Left Heart Wall Stress | Systole
<li> Circulation | Left Heart Pumping | Contractile Protein
</ul>

<p>
2013-02-24. HumMod bumped to v2.0.53.

<p>
Added the math to calculate left and right ventricle wall
stress at end-diastole and end-systole. Two top level structures
have been created : LeftVentricleWallStress and RightVentricleWallStress
with Mass, Diastole and Systole child structures. Visible at
Circulation | Left Heart Wall Stress and Right Heart Wall Stress.

<p>
Added top-level structure PressureTools since we are converting
between mmHg and kDynes/cM^2.

<p>
Removed structures LeftHeartPumping-Work and RightHeartPumping-Work
and panels under Circulation | LeftHeartPumping and RightHeartPumping.
That is not how the heart works (no pun).

<p>
2013-02-22. Connecting work to contractile protein in the left
heart was done very poorly and always led to a loss of muscle
(heart failure and hypotension) -- which was evident at a week
and really evident at a month. This functionality is now shut
down while much better physiology is being prepared. Patch is
visible at Structure\Left and RightHeartPumping\Left and
RightHeartPumping-ContractileProtein.

<p>
2013-02-21. Fixed an invalid empty integer element in Bladder |
Proteinuria. I screwed this up when editing the bladder panel
recently.

<p>
Sized the pericardium and did some work on its values and pressure
-volume relationship. It's a bit less stiff at the normal heart
volume. Added Pericardium Notes.TXT to Structure\Pericardium.

<p>
2013-02-20.The kidney O2 shunt has two calculations that use
kidney blood flow in their denominator. So they throw a divide by
zero when kidney blood flow is zero (as in v-fib). I trapped
these for zero flow, where shunt is basically undefined. Thanks
to Robert Hester for this. The XML is in Structure\Kidney\
Kidney-TubuleO2.DES.

<p>
Added a pressures reference to sizing. These pressure do not
actually size any pressures, but instead are used to size
vascular compliance and vascular conductance during sizing
operations. XML in Sizing-Pressure. Visible at Sizing | Pressures.

<p>
Adding sizing for the blood vessels (vascular compartments) using
blood volume, these pressures, cardiac output and a varient of
relevant fractions. XML is in Structures\Sizing. The parent structure
is Sizing-BloodVessels followed by vascular structures prefixed
with Sizing-.

<ul>
<li> Arteries
<li> SystemicArteries
<li> Veins
<li> PeripheralVeins
<li> SplanchnicVeins
<li> RightAtrium
<li> Lungs
<li> PulmonaryArtery
<li> PulmonaryCapillaries
<li> PulmonaryVeins
<li> LeftAtrium
</ul>

<p>
Visible at Sizing | Blood Vessels.

<p>
2013-02-19. HumMod version bumped to 2.0.52. Edited display to
make Circulation | Blood Vessels | Arteries | Systemic Arteries
visible. This panel just wasn't connected.

<p>
2013-02-18. HumMod version bumped to 2.0.51. Adding mass
balance for 20 amino acids -- 10 essential and 10 non-essential.
First compartments are extracellular, in Structure\AminoAcid.
Structure names have AA- prefix. Panel is at Metabolism |
Amino Acids | ECFV.

<p>
Under development but not completed is scaling the vascular
compartments at startup so that the model is context sensitive
but not parameter sensitive. Coming next.

<p>
2013-02-17. HumMod version bumped to 2.0.50. Finishing up
renal O2 shunt and EPO. Added some reference files in
Structure to EPO and Kidney-TubuleO2.

<p>
EPO now gets 3 panels : pool, secretion and disposal. Added
detail includes pG/mL, an [EPO] clamp, parametric volume
of distribution and parametric 1/2 life.

<p>
RBC's also get 3 panels under Body Fluids | Blood | Red
Cells : pool, secretion, disposal. Delay of [EPO] effect
on red cell formation and red cell lifespan are now
adjustable parameters.

<p>
2013-02-16. HumMod version bumped to 2.0.49. It now seems
that there are lots of cells in the renal cortex that can
secrete EPO, with the juxtamedullary region the first to
act. So what was called proximal tubule pO2 is now extended
to tubule O2. Editing is visible at Organs | Kidney | Tubule
O2. XML editing is visible at Structure\Kidney\TubuleO2.

<p>
Added preglomerular O2 shunting to the kidney. This looks
like a very important physiological part of the control of
EPO secretion.

<p>
HumMod now goes for 1 month on 7672 steps and 2765 retries.
BP drifts down to 104/65. Plasma volume expands. But EPO
seems well controlled and RBC volume stays flat at around
2380 mL. More to follow ...

<p>
2013-02-13. Expanded autopsy report to include both
examination and chemistry. 

<p>
In posture control and energy and status, a constant was
named both TILTED and TILTING, eliciting an unknown variable
error when HumMod dies. Fixed to TILTING for all references.

<p>
2013-02-12. HumMod version bumped to 2.0.48. Put lots of
note files on amino acids in Structure\AminoAcid\Notes.
These are references for future expansion of amino acid
physiology.

<p>
2013-02-10. HumMod version bumped to 2.0.47. Time for
some cleaning up. Deleted heat panels under Miscellaneous.
Heat now has its own top level pop-down menu. Had to update
some paths that were pointing back to Miscellaneous.

<p>
Twelve major organs defined FAFraction (KAFraction in the
brain) in a block named Failed that is executed when the
organ has failed. But FAFraction was no longer declared, so
a left-side variable is not declared error would occur when
this block was executed. Deleted 12 defines that are no
longer needed.

<p>
Renamed the curve FAFraction to FAUsedFraction in structures
and panels. This is just a matter of style.

<p>
Found and deleted orphan GITract panels embedded in the Fat
panels folder.

<p>
Note to Robert. You can advance the solution, change the
context (the entire model is rescaled) and advance the
solution some more. But female scaling is not yet complete
-- some parameters are highly out of bounds -- so the
solution struggles along rather slowly. Typical values are
600 steps and 60 retries for 1 male day and 9000 steps and
1200 retries for 1 female day.

<p>
2013-02-09. Added dosing and pharmacokinetics for
acetazolamide. Structures are at Structures\Drugs\
Acetazolamide. Panels are visible at Interventions |
Drugs | Acetazolamide (dosing) and Miscellaneous |
Pharmacokinetics | Acetazolamide (kinetics). 

<p>
Fixed hemodialysis. HumMod was taking calories from the
body in ultrafiltrate but was not taking the water lost
from body water. So HumMod developed a sever hypothermia
and fibrillated. Fixed XML is in Structure\BloodVolume\
PlasmaVol.DES. Added a reference at Structure\H2O\BodyH2O.
Thanks to David Julian.

<p>
Shivering was quantitatively incorrect -- calories produced
was too small. Added a reference file at Structure\Heat
named HeatShivering.REF. It cites the gold standerd reference.
Structure XML is at Structure\Heat\HeatShivering. Panel is at
Heat | Movement | Shivering. This needs some validation next.

<p>
2013-02-08. HumMod version bumped to 2.0.46. For the 12
major organs, I cleaned up the look of the fuel panel.
This is cosmetic only.

<p>
2013-02-05. HumMod version bumped to 2.0.45. Calculation
of collecting duct and bladder urine pH has been revised
to include the concept of a negative SID, although first
principle calculations do not yet exist. The status of
this is noted in Structure\AcidBase\PhUrine.REF.

<p>
Modified structure XML is in AcidBase\PhUrine.DES,
Bladder\Bladder.DES and Nephrons\CollectingDuct\CD_Ph.DES.
Results are visible at Organs | Bladder, Organs |
Kidney ... Excretion | Urine and Organs | Kindey ...
Excretion | Acid-Base.

<p>
Testing starvation (H2O ad lib only). Control after
1 day. Starvation for 1 week.

<table>
<tr><td></td><td>Control</td><td>Starvation</td></tr>
<tr><td>Weight</td><td>163</td><td>152</td></tr>
<tr><td>Body H2O</td><td>42.7</td><td>39.4</td></tr>
<tr><td>Blood [Na+]</td><td>138.6</td><td>131.1</td></tr>
<tr><td>" [K+]</td><td>4.2</td><td>3.3</td></tr>
<tr><td>" [Cl-]</td><td>103.8</td><td>98.6</td></tr>
<tr><td>" [KA-]</td><td>0.7</td><td>2.8</td></tr>
<tr><td>Urine pH</td><td>6.05</td><td>4.34</td></tr>
<tr><td>" [KA-]</td><td>2.6</td><td>145.5</td></tr>
<tr><td>" [NH4+]</td><td>27.1</td><td>80.5</td></tr>
<tr><td>Blood [Glucose]</td><td>99.2</td><td>57.9</td></tr>
<tr><td>" [Insulin]</td><td>17.8</td><td>7.6</td></tr>
<tr><td>" [Glucagon]</td><td>69.7</td><td>230.2</td></tr>
<tr><td>Vein pH</td><td>7.37</td><td>7.30</td></tr>
<tr><td>Brain % Glucose</td><td>93</td><td>34</td></tr>
</table>

<p>
2013-02-05. I informally reviewed HumMod's XML to see
just how well-formed its XML is. Well formed in the
XML world means that the document conforms to the
basic rules of XML. Some edits were made.

<p>
Mixed Content. Mixed content is content within an XML
element that contains both text and child XML elements.
This is allowed in XML -- which is understandable since
XML is the offspring of Standard Document Markup
Language (SGML). As its name states, it is a document
markup language. So all of the text (including file
headers and occasional annotation) is mixed content
and is well formed.

<p>
Mixed content makes XML more human readable. But it
can drive parsers crazy when the parsers are meant for
documents moving data from computer to computer.
HumMod's parsers support mixed content and this is
meant to help persons reading and editing the XML.

<p>
XML documents should not contain free text before the
opening root (document) tag and after the closing root
(document) tag. I edited HumMod.DES to make it
conform.

<p>
There are 5 ASCII characters that are not allowed in
XML element content. There characters must be represented
by a character entity, which begins with an ampersand
and ends with a semicolon. The characters and their
character entities are

<ul>
<li> Less than (&lt;) : &amp;lt;
<li> Ampersand (&amp;) : &amp;amp;
<li> Greater Than (&gt;) : &amp;gt;
<li> Apostrophe (&apos;) : &amp;apos;
<li> Quotation Mark (&quot;) : &amp;quot;
</ul>

<p>
HumMod's parsers do not honor these character entities,
so to have well formed XML these characters or their
entities must not appear in XML content (except inside
XML comments).

<p>
I replaced ampersand with and in 6 display files.
<ul>
<li> ...\Lifestyle\Exercise\Treadmill\Summary.DES
<li> ...\Miscellaneous\Torso\Lower\Capillaries-Lymph\Capillaries-Lymph.DES
<li> ...\Miscellaneous\Torso\Middle\Capillaries-Lymph\Capillaries-Lymph.DES
<li> ...\Miscellaneous\Torso\Upper\Capillaries-Lymph\Capillaries-Lymph.DES
<li> ...\Organs\KidneyExcretion\Bicarbonate\\BicarbonateExcretion.DES
<li> ...\Organs\KidneyExcretion\Chloride\\ChlorideExcretion.DES
</ul>

<p>
I replaced quotation marks with dashes from 2 display files.
<ul>
<li> ...\Disgnosis\Chart\Symptoms.DES
<li> ...\Organs\Bladder\Proteinuria.DES
</ul>

<p>
2013-02-04. Added a ... Metabolism submenu to Kidney
under organs. This makes the Organs menu a bit busy,
but it gets some important stuff up to the top. This
submenu will display kidney gluconeogenesis, ammonia
formation and ketoacid metabolism -- all interrelated.

<p>
Added an Acid-Base panel to Kidney ... Excretion to
help track acid-base status, particularly renal
excretion. Panel is visible at Organs | Kidney ...
Excretion | Acid-Base.

<p>
Changed the way the kidney handles ketacids to reflect
saturable and non-saturable reabsorption. XML is at
Structure\Nephrons\NephronKetoacids. Display at Organs |
Kidney ... Excretion | Ketoacids.

<p>
2013-02-03. HumMod version bumped to 2.0.44.

<p>
Calculating urine pH in collecting duct and bladder.
The general tool is located in Struncture\AcidBase\PhUrine.

<p>
ADDED LATER - this does not work correctly during starvation
and is now under review (2013-02-05).

<p>
The strong cations used are [Na+] and [K+]. The strong
anions used are [Cl-] and [KA-].

<p>
Bladder pH is calculated at Structure\Bladder\BladderPh.
Acid-base status is displayed at Organs | Bladder.

<p>
Collecting duct pH is calculated at Structure\Nephrons\
CollectingDuct\CD_Ph. Acid-base status is displayed at
Organs | Kidney ... Excretion | Urine.

<p>
2013-02-02. HumMod version bumped to 2.0.43.

<p>
Under Display | Organs | Kidney, HumMod had a ... Nephrons
submenu. I added a second submenu labeled ... Excretion
listing panels related to renal excretion -- most notable
the Urine panel.

<p>
I'm not totally sure about this, but after doing some
reading I demoted inorganic phosphate and sulfate from
strong anions to weak anions in the blood SID calculation
and display. Math is at Structure\BloodIons\BloodIons.DES.
Display is at Diagnosis | Blood Chemistry | Sample.

<p>
Moved Metabolism | Lipid Deposits to Organs | ... Lipid
Deposits under Adipose Tissue.

<p>
Moved Metabolism | Liver Metabolism to Organs | ... Metabolism
under Liver.

<p>
2013-02-01. HumMod version bumped to 2.0.42.

<p>
In response to a report from Matteo Pecchiari in Milan,
I checked out HumMod's bladder. It does accumulate protein.
Added clinical units for [Protein] of mG/dL and calculated
severity of proteinuria as Trace, 1+, 2+, 3+ and 4+. Structure
is at Bladder\BladderProtein. Display is at Organs | Bladder
using a new Proteinuria box. Severity is described in info
box.

<p>
2013-02-01. Adding some comments on launching ScriptedController
with the script to be run specified in the command line.

<p>
The ScriptedController plus script info can be launched using
the Command Prompt utility (cmd.exe) or a shortcut to the
ScriptedController configured with the requisite information.
In both cases, the information needed is identical.

<p>
A word about Windows. Windows supplies applications with two
items descibing the command line. The first is a string with
the complete contents of the command line. The second is an
array of strings with the contents of the command line parsed
into the array. The delimiter for this parser is whitespace.
So a path containing one or more spaces is potential trouble.

<p>
To make this work, the system parser treats all text within
double quotes as a single item. You can see this working by
right clicking any desktop icon and then selecting properties.
Notice the target specification safely in double quotes.

<p>
SciptedController expects the name of the app in array element
zero (which it ignores) and the XML script specification in
array element one. So when using the Command Promptput or a
shortcut put a pair of double quotes around the application
specification and a second pair of double quotes around the
script specification XML.

<ul>
<li> Double quotes around app and script specification.
<li> Single quotes won't work.
<li> File names, paths and drive letters are not case sensitive
in Windows.
<li> The .exe or .EXE name extension for executables is optional
but the .Script (or whatever) name extension is required for
scripts.
<li> Use properly formed and valid XML as decribed below.
</ul>

<p>
2013-01-31. The command line schema for the ScriptedController
is

<p>
&ltroot&gt;&ltscript&gt; Valid Script Name &lt/script&gt;&lt/root&gt;

<p>
XML content in the command line takes precedence over the
startup information in the registry. Note also that you
can hold down the control key (Ctrl) when launching the
ScriptedController and both the command line content and
registry information will be ignored.

<P>
2013-01-28. This log described mods made to HumMod on
2012-11-05 upgrading the fuel selector. The version was 2.0.39.
But this version was never pushed so I've deleted the notes
and will recreate the appropriate mods now.

<p>
2013-01-28. HumMod version bumped to 2.0.41.

<p>
HumMod previously used a linear predictor to predict fatty
acid vs. glucose use in each of the major organs. This
worked OK with normal deliveries but not with unusual
deliveries -- specifically brain ketoacid use during
startvation.

<p>
So I replaced this predictor with a non-linear one that
is much better. The expense is that fatty acid preference
is no longer a working parameter. There is a detailed
reference in Structure\FuelSelector. The new predictor
is visible at 'Organ' | Fuel for each organ.

<p>
2013-01-27. Bumped HumMod 2.0.39 to 2.0.40.

<p>
I've renamed the structure folder and structure file
from VascularCompartments to BloodVessels. This is
just a matter of style.

<p>
Reorganized the menus and panels under Circulation |
Blood Vessels to create 3 major groupings

<ul>
<li> Arteries
<li> Veins
<li> Lungs
</ul>

<p>
2013-01-26. Bumped HumMod 2.0.38 to 2.0.39.

<p>
There were 4 occurances in 2 files where the empty
element &lt;integer/&gt; was referred to as
&lt;integer&gt;. Fixed.

<p>
The goal is to go 1 week in steady-state in 2000
steps or less. But 2.0.38 would slow at about 5
days and required about 5300 steps. This slowing
was caused by LeftAtrium.DxMax being slightly too
large (0.005 * Compliance) -- leading to a bit of
jitter. So I decreased it to 0.0001 * Compliance.
Now it uses 2207 steps (460 retries) in EXE and
2231 steps (513 retries) in Modular.

<p>
2013-01-12. The design with ScriptedController and
InteractiveController is to use simple schemas for
saving and loading initial conditions and solutions.
These two schemas were installed about a year ago
(I'm guessing). Older files will not be compatible
and will not parse.

<p>
These two schemas are specified in the applications
at Docs\Schemas\... and are repeated here.

<p>
&lt;ics&gt;
<br>
&lt;var&gt;
<br>
&lt;name&gt; Name &lt;/name&gt;
<br>
&lt;val&gt; Value &lt;/val&gt;
<br>
&lt;/var&gt;
<p>
More vars here.
<p>
&lt;/ics&gt;

<p>
&lt;solution&gt;
<br>
&lt;var&gt;
<br>
&lt;name&gt; Name &lt;/name&gt;
<br>
&lt;val&gt; Value &lt;/val&gt;
<p>
More values here.
<p>
&lt;/var&gt;
<p>
More vars here.
<p>
&lt;/solution&gt;

<p>
Note that unstructured text is allowed before the
opening root tag and after the closing root tag.

<p>
2013-01-08. In the ClientController, the pipe polling
interval appears to be 1000 mS, as seen in Advanced |
Pipe. This interval (which is large) could add to the
latency. The default interval for the other modular
components is 200 mS -- providing pretty decent
performance.

<p>
2013-01-07. Some of the tests reported below used a
desktop with an Internet connection. Characterized
the desktop using Belarc Adviser. It is an HP with
4 core AMD running at 2.9 gHz on 6 mBytes RAM.

<p>
Characterized the Internet connection using speedtest.net.

<ul>
<li>
Ping : 10 mSec
<li>
Download : 19.8 mBytes/Sec
<li>
Upload : 3.6 mBytes/Sec
</ul>

<p>
2013-01-07. Then pinged some destinations that we
use. Results are reported in mSec.

<ul>
<li>
hummod.org : 60 mSec
<li>
digitalhumanmodels.org : 94 mSec
<li>
biosim.com : ICMP is blocked, but rather fast.
<li>
ip-50-63-52-240.ip.secureserver.net : 69 mSec --
this is the URL that the ClientController talks
to (more on this below).
<li>
solveradmin.connect-technologies.net : 69 mSec
<li>
github.com : 59 mSec
<li>
google.com : 75 mSec
</ul>

<p>
2013-01-07. Restart on HumMod.EXE is too quick to be
measured -- maybe 10 to 100 mSec. Restart on client -
server is 2.97 Sec. Considering nearly zero elapsed
time on the controller and on the model solver, it
appears that the time cost of communication for a
single transaction is about 3 seconds. Note that a
restart returns a values frame and all of the starting
map data. Client to server communication was 1 message
in 1792 bytes. Server to client communication was 1
message in 183,285 bytes.

<p>
But some of the time cost in the above test may be due
to message size. So I picked Advanced | Variables and
then clicked on a variable name. This triggers a round
trip fetch of details for the named variable -- with
very small message content. Client to server is 1
message in 65 bytes. Server to client is 1 message in
216 bytes. Elapsed time was 2.88 seconds. So the
latency appears to be inherent and only slightly
dependent on the message size.

<p>
2013-01-06. Summary of 6 hour, steady-state protocol
in various environments. Values are elapsed time in
seconds.

<ul>
<li>
HumMod.EXE : 3.32 Seconds.
<li>
Interactive Controller - Model Solver : 5.15 Seconds.
<li>
Scripted Controller - Model Solver : 4.18 Seconds.
<li>
Client - Server : 7.41 Seconds.
<li>
HumModWeb : 2.67 Seconds.
</ul>

<p>
2013-01-06. One more 6 hour steady-state protocol. This
one used HumModWeb (v1.0.1) with the source XML coming
from HumMod v2.0.0 (I think) (266,934 tags). The
environment was the same desktop used in the other tests,
Windows 7 and FireFox 17.0.1.

<p>
Loading required 9.8 seconds and the 6 hours steady-state
test was completed in 2.67 seconds. First and repeated
simulations were all roughly the same speed.

<p>
2013-01-06. ClientController Notes

<p>
The most recent ClientController has its own application
name, icon and registry key. The executable is smaller
than before, suggesting that the debugging hooks have
been removed.

<p>
ClientController.exe 1,128,960 bytes 6/28/2012 (Old)
<br>
ClientController.exe   324,608 bytes 1/6/2013 (Current)

<p>
We also need a config file present in the executable
directory -- for some unknown reason.

<p>
ClientController.exe.config 1,742 bytes 6/28/2012 (Old)
<br>
ClientController.exe.config 1,873 bytes 1/6/2013 (Current)

<p>
To install the ClientController, go to Advanced | 
Solver - Model.

<p>
The solver specification must point to any existing path
on the client machine. It is parsed and then ignored. I
made the mistake of setting it to an empty string. The
path parser failed, threw an exception, and shut down
the client. The only way to repair this, I think, is to
use regedit.exe to enter the registry and edit in a
valid entry.

<p>
The the model specification is significant since it
points to the model XML on the server. The correct
entry is

<p>
c:\Websites\HumMod\library\HumMod.DES

<p>
2013-01-06. I repeated the 6 hour steady-state protocol
described below using the server - client environment and
the same desktop as used below. HumMod version was 2.0.15.

<p>
Startup (launch client to draw chart panel) required 21
seconds. Model solver used 2.81 seconds to parse the XML
(274,092 tags). This suggests that the server is fast enough,
but keep in mind that no disk writes are involved. Client
used 3.70 seconds to parse the display message (562 panels).
This is rather slow. Startup messaging consisted of 3
messages in 2020 bytes from client to server and 4 messages
in 2,827,261 bytes from server to client.

<p>
The 6 hour steady-state protocol runs in 7.41 seconds. The
display interval with this version of HumMod is 60 minutes,
so a total of 6 value frames were returned (1235 mS per
frame). The solution used 190 steps and 46 retries with an
average step size of 1.89 minutes. Messaging consisted of
1 message in 107 bytes from client to server and 6 messages
in 805,478 bytes from server to client.

<p>
There appears to be a large amount of network traffic involving
the client and server EVEN when both the client and model
solver are idle. No bytes are moved so this appears to be
handshaking. Traffic stops when the client is closed. This
can be monitored using Resource Monitor.

<p>
2013-01-04. I ran some timing tests to get basic information
before jumping into the compression discussion. Tests involved
6 hours of steady-state with no run in at the start. Solution
interval was 360 minutes with display at 30 minutes. All tests
used HumMod v2.0.39.

<p>
The first test used HumMod.EXE. Elapsed time was 3.32 seconds.
Solution required 328 steps with 17 retries. Average step size
was 1.1 minutes. In this environment, there is no communication
time since the solver algorithm writes directly into the display
buffer. Visible panel is updated (including graphs). A total of
12 solution sets was delivered by the solver to the display buffer.
Note that this version of HumMod uses its own numerical methods,
so results may not compare directly to the following test.

<p>
So the take away here is that solution and panel refresh for
this protocol requires about 277 mS per display interval with
no communication cost. The cost of solution vs. cost of panel
update cannot be teased out.

<p>
The second test used the Interactive Controller (v1.1.14) and
the Model Solver (v1.0.14). The pipe polling interval was
200 mS. Elapsed time was 5.16 seconds. Solution required 321
steps with 16 retries. Average step size was 1.12 minutes. The
same 12 sets were delivered by the solver through the bidirectional
pipe. Visible panel is updated (including graphs).

<p>
A repeat took 4.95 seconds. Controller to Solver communications
consisted of 1 message and 107 bytes. Solver to Controller
communications consisted of 6 messages and 882610 bytes. Note
that more than one values frame will be packed into a message
if solution values are available in a timely fashion.

<p>
So the take away here is that solution plus communication plus
panel update requires 430 mS per display interval. Using the
previous results yields 277 mS for solution and display and 153
mS for communication. The only significant communication runs
from Solver to Controller. The communication cost consists of
message creation, transport, and message parsing and consumption.
Note that Controller and Solver are both running on the same
CPU, so that time slicing is at work.

<p>
For perspective, I profiled the startup timing -- when the Model
Controller is launched and it in turn launches the Model Solver
and it in turn parses the model. Startup is complete when the
Controller displays the first panel and signals 'Ready'.
Elapsed time was 8.65 seconds. Model Solver parsing time was
2.73 seconds (303400 tags). Model Controller parsing time was
0.89 seconds (602 panels defined in an incoming message).

<p>
Checking the message boxes showed that Controller to Solver
messages consisted of 3 messages and 6912 bytes. Solver to
Controller messages consisted of 4 messages and 3209222 bytes.
These are all one time messages used to install the Controller.

<p>
The absolute fastest that the model can run when it is in
steady-state and after it has settled into steady-state. To
document this, I ran for 6 hours and then an additional 6
hours -- timing the second part of the protocol. When looking
at these numbers, there is a very important consideration --
after the solver receives a gofor or goto message, it does
not wait on the pipe. It calculates away until the solution
is complete and results (value frames) are dumped into the
pipe (or its buffer) as they become available.

<p>
The Solver advanced the solution in 113 steps and 26 retries
over 1.70 seconds or 142 mS per display interval. This is as
fast as it will go. The Controller required 2.77 seconds or
231 mS per display interval. 

<p>
I'm just going to review message traffic here to make sure.
<br>
Startup : 3 To Solver in 6912 Bytes. 4 to Controller in 3209222 Bytes.
<br>
First 6 Hours : 1 to Solver in 107 Bytes. 6 to Controller in 882610 Bytes.
<br>
Second 6 Hours : 1 to Solver in 107 Bytes. 6 to Controller in 884515 Bytes.

<p>
Next, I wrote a script that duplicated the 6-hour steady-state
protocol and executed it using the Scripted Controller. Total
elased time was 12 seconds. Script parsing time was 0.03
seconds and model parsing time was 2.75 seconds. There were
3 Controller to Solver messages of 259 bytes and 13 Solver to
Controller messages of 2151794 bytes. These Controller incoming
messages were both startup and solution messages.

<p>
Solution used 327 steps and 15 retries with an average step-size
of 1.10 minutes. Solution elapsed time was 4.18 seconds.

<p>
Total Takeaway (based on impressions rather that hard numbers).
Values are in mS per display interval.
<br> Solution : 142 and up. Depends on size of interval and transients.
<br> Calculating : 132 and up.
<br> Waiting For Timeslice : 10. Could be faster or slower on server.
<br> Panel Update : 1. Will be slower when maps are visible.
<br> Messaging : 100
<br> Message Creation : 1
<br> Transport : 49 for file system. Might be slower over the wires,
but might be faster since multiple processors are involved.
<br> Parsing : 40
<br> Polling Inefficiency : 10 but none over Internet

<p>
Remember that after decompressing the complete message must still be
parsed. So the critical question is whether or not the time required to
compress and decompress is more or less than the time saved in transporting
a smaller message. An algorithm such as ZIP is great on size but terrible
on time, so it will probably will be bad news. What is a better algorithm?
I don't know.

<p>
The other thing that strikes me is that the rate limiting step is either
the rate at which the server can calculate and push out packets or the
rate at which the browser can consume the packet. For the first display
interval in a solution, the transport time might be significant. At all
other times, it won't be significant and the compression / decompression
will just be an added burden.

<p>
And then another thing struck me. Windows (I think) does a delayed write
in its file system. This means that it actually writes to memory and then
flushes memory to the disk drive later when it is not busy. But if we
run a pipe that gets a write and 200 mS or less does a read and then
delete, the data never goes to disk and the system is fast. So the
numbers that I got here could be fast and misleading.

<p>
<span class='pageend'> End </span>

</body>
</html>
